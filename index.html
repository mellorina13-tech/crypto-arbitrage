<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Crypto Arbitrage Scanner - Real Market Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
        }

        .header .subtitle {
            color: #a0a0a0;
            margin-bottom: 15px;
        }

        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid #4caf50;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            color: #4caf50;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .status-dot.loading {
            background: #ffc107;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d2ff;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #a0a0a0;
            font-size: 0.85rem;
        }

        .price-ticker {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticker-content {
            display: inline-block;
            animation: scroll 60s linear infinite;
            font-size: 0.9rem;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .controls {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 120px;
        }

        label {
            font-size: 0.85rem;
            color: #a0a0a0;
            font-weight: 500;
        }

        input, select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #00d2ff;
            box-shadow: 0 0 0 2px rgba(0, 210, 255, 0.2);
        }

        .scan-btn {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: #fff;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3);
        }

        .scan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 210, 255, 0.4);
        }

        .scan-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .opportunities-grid {
            display: grid;
            gap: 18px;
        }

        .opportunity {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 22px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .opportunity::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .opportunity:hover {
            transform: translateY(-3px);
            border-color: rgba(0, 210, 255, 0.4);
            box-shadow: 0 8px 25px rgba(0, 210, 255, 0.15);
        }

        .opportunity:hover::before {
            opacity: 1;
        }

        .opp-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 18px;
        }

        .coin-info h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
            color: #fff;
        }

        .coin-details {
            font-size: 0.85rem;
            color: #a0a0a0;
            line-height: 1.4;
        }

        .coin-price {
            font-weight: 600;
            color: #00d2ff;
        }

        .price-change {
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .price-change.positive {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .price-change.negative {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .profit-display {
            text-align: right;
        }

        .profit-percentage {
            font-size: 2rem;
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 4px;
        }

        .profit-percentage.high {
            color: #00ff88;
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .exchanges {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 18px;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 18px;
            margin: 15px 0;
        }

        .exchange {
            text-align: center;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .exchange-name {
            font-weight: 600;
            color: #00d2ff;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .exchange-price {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 6px;
            color: #fff;
        }

        .exchange-label {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .buy-label {
            background: rgba(76, 175, 80, 0.25);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .sell-label {
            background: rgba(244, 67, 54, 0.25);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        .arrow {
            font-size: 1.8rem;
            color: #00d2ff;
            animation: moveArrow 2s ease-in-out infinite;
        }

        @keyframes moveArrow {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(8px); }
        }

        .profit-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 12px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .profit-item {
            font-size: 0.8rem;
        }

        .profit-item-label {
            color: #a0a0a0;
            margin-bottom: 3px;
        }

        .profit-item-value {
            font-weight: 600;
            color: #4caf50;
        }

        .loading, .no-results {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d2ff;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .last-updated {
            font-size: 0.75rem;
            color: #4caf50;
            margin-top: 8px;
            text-align: center;
        }

        .api-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 0.8rem;
            color: #8b5cf6;
            margin-top: 10px;
        }

        .warning-badge {
            background: rgba(255, 152, 0, 0.15);
            border: 1px solid #ff9800;
            color: #ff9800;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 10px;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .exchanges { 
                grid-template-columns: 1fr; 
                gap: 12px;
            }
            .arrow { 
                transform: rotate(90deg); 
                animation: none; 
            }
            .control-row { 
                flex-direction: column; 
                align-items: stretch; 
            }
            .control-group { 
                min-width: auto; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Crypto Arbitrage Scanner</h1>
            <p class="subtitle">Real Exchange Data - Professional Arbitrage Detection</p>
            <div class="api-status" id="apiStatus">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting to exchanges...</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="opportunitiesCount">0</div>
                <div class="stat-label">Live Opportunities</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="bestSpread">0%</div>
                <div class="stat-label">Best Spread</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="coinsTracked">0</div>
                <div class="stat-label">Coins Tracked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="apiCalls">0</div>
                <div class="stat-label">API Calls</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="lastUpdate">--:--</div>
                <div class="stat-label">Last Update</div>
            </div>
        </div>

        <div class="price-ticker" id="priceTicker">
            <div class="ticker-content" id="tickerContent">
                Initializing live price feed...
            </div>
        </div>

        <div class="controls">
            <div class="control-row">
                <div class="control-group">
                    <label for="minSpread">Min Spread %</label>
                    <input type="number" id="minSpread" value="0.1" min="0.01" max="20" step="0.01">
                </div>
                <div class="control-group">
                    <label for="coinLimit">Coins to Scan</label>
                    <select id="coinLimit">
                        <option value="10">Top 10 (Fast)</option>
                        <option value="25">Top 25</option>
                        <option value="50" selected>Top 50</option>
                        <option value="100">Top 100</option>
                        <option value="250">Top 250</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="volumeFilter">Min Volume</label>
                    <select id="volumeFilter">
                        <option value="0">No Minimum</option>
                        <option value="1000000" selected>$1M+</option>
                        <option value="10000000">$10M+</option>
                        <option value="100000000">$100M+</option>
                    </select>
                </div>
                <button class="scan-btn" onclick="scanMarkets()" id="scanBtn">
                    <span>‚ö°</span> Scan Live Markets
                </button>
            </div>
        </div>

        <div class="opportunities-grid" id="opportunitiesContainer">
            <div class="loading">
                <div class="spinner"></div>
                <h3>Connecting to Exchanges</h3>
                <p>Fetching real-time cryptocurrency data from multiple exchanges...</p>
            </div>
        </div>
    </div>

    <script>
        // Netlify Function API endpoint
        const API_ENDPOINT = '/.netlify/functions/get-prices';
        
        // Exchange fee information (for profit calculation)
        const EXCHANGE_FEES = {
            binance: 0.1,
            kucoin: 0.1,
            gateio: 0.2,
            mexc: 0.2,
            bybit: 0.1,
            okx: 0.1,
            huobi: 0.2,
            bitget: 0.1
        };

        const EXCHANGE_NAMES = {
            binance: 'Binance',
            kucoin: 'KuCoin',
            gateio: 'Gate.io',
            mexc: 'MEXC',
            bybit: 'Bybit',
            okx: 'OKX',
            huobi: 'Huobi',
            bitget: 'Bitget'
        };

        const COINGECKO_BASE_URL = 'https://api.coingecko.com/api/v3';
        
        let livePrices = {};
        let opportunities = [];
        let apiCallCount = 0;
        let lastUpdateTime = null;

        function updateApiStatus(status, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = `status-dot ${status}`;
            statusText.textContent = message;
            
            const apiStatusEl = document.getElementById('apiStatus');
            apiStatusEl.style.borderColor = status === 'online' ? '#4caf50' : 
                                           status === 'loading' ? '#ffc107' : '#f44336';
        }

        // Fetch coin list from CoinGecko
        async function fetchCoinList() {
            const coinLimit = parseInt(document.getElementById('coinLimit').value);
            
            try {
                console.log(`üì° Fetching top ${coinLimit} cryptocurrencies from CoinGecko...`);
                
                const url = `${COINGECKO_BASE_URL}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=${coinLimit}&page=1&sparkline=false&price_change_percentage=24h`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                apiCallCount++;
                
                livePrices = {};
                data.forEach((coin, index) => {
                    livePrices[coin.symbol.toUpperCase()] = {
                        id: coin.id,
                        name: coin.name,
                        symbol: coin.symbol.toUpperCase(),
                        market_cap: coin.market_cap,
                        volume_24h: coin.total_volume,
                        percent_change_24h: coin.price_change_percentage_24h || 0,
                        rank: index + 1,
                        exchangePrices: {}
                    };
                });
                
                console.log('‚úÖ Coin list received:', Object.keys(livePrices).length, 'coins');
                return true;
                
            } catch (error) {
                console.error('‚ùå CoinGecko API failed:', error);
                return false;
            }
        }

        // Fetch prices from all exchanges via Netlify Function (with batching for large requests)
        async function fetchExchangePrices(symbols) {
            const symbolList = Array.isArray(symbols) ? symbols : [symbols];
            const BATCH_SIZE = 20; // Process 20 coins at a time to stay under 10s timeout
            
            console.log(`üìä Total symbols to fetch: ${symbolList.length}`);
            
            // If small request, send all at once
            if (symbolList.length <= BATCH_SIZE) {
                const symbolString = symbolList.join(',');
                
                try {
                    console.log(`üîç Fetching ${symbolList.length} coins in single request...`);
                    
                    const response = await fetch(`${API_ENDPOINT}?symbols=${symbolString}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.error || 'Unknown error');
                    }
                    
                    console.log('‚úÖ Received prices from backend');
                    apiCallCount++;
                    
                    return result.data;
                    
                } catch (error) {
                    console.error('‚ùå Backend API error:', error);
                    return null;
                }
            }
            
            // For large requests, batch them
            console.log(`üì¶ Large request! Batching ${symbolList.length} coins into groups of ${BATCH_SIZE}...`);
            
            const allResults = {};
            const batches = [];
            
            // Split into batches
            for (let i = 0; i < symbolList.length; i += BATCH_SIZE) {
                batches.push(symbolList.slice(i, i + BATCH_SIZE));
            }
            
            console.log(`üìä Created ${batches.length} batches`);
            
            // Process each batch sequentially
            for (let i = 0; i < batches.length; i++) {
                const batch = batches[i];
                const batchString = batch.join(',');
                
                updateApiStatus('loading', `Batch ${i + 1}/${batches.length}: Fetching ${batch.length} coins...`);
                console.log(`üîç Batch ${i + 1}/${batches.length}: Processing ${batch.length} coins`);
                
                try {
                    const response = await fetch(`${API_ENDPOINT}?symbols=${batchString}`);
                    
                    if (!response.ok) {
                        console.error(`‚ùå Batch ${i + 1} failed: HTTP ${response.status}`);
                        continue;
                    }
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        console.error(`‚ùå Batch ${i + 1} failed:`, result.error);
                        continue;
                    }
                    
                    // Merge results
                    Object.assign(allResults, result.data);
                    
                    console.log(`‚úÖ Batch ${i + 1}/${batches.length} completed - ${Object.keys(result.data).length} coins received`);
                    apiCallCount++;
                    
                    // Small delay between batches
                    if (i < batches.length - 1) {
                        console.log(`‚è≥ Waiting 500ms before next batch...`);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                } catch (error) {
                    console.error(`‚ùå Batch ${i + 1} error:`, error);
                }
            }
            
            console.log(`‚úÖ All batches completed - total ${Object.keys(allResults).length}/${symbolList.length} coins processed`);
            
            return Object.keys(allResults).length > 0 ? allResults : null;
        }

        // Find real arbitrage opportunities
        async function findRealArbitrageOpportunities() {
            const opportunities = [];
            const minSpread = parseFloat(document.getElementById('minSpread').value);
            const minVolume = parseFloat(document.getElementById('volumeFilter').value);

            const eligibleCoins = Object.values(livePrices).filter(coin => 
                coin.volume_24h >= minVolume
            );

            console.log(`üí∞ Scanning ${eligibleCoins.length} eligible coins...`);

            // Fetch all prices in one API call (batch request)
            updateApiStatus('loading', `Fetching prices from exchanges...`);
            const symbols = eligibleCoins.map(coin => coin.symbol);
            const allPrices = await fetchExchangePrices(symbols);

            if (!allPrices) {
                console.error('‚ùå Failed to fetch prices from backend');
                return [];
            }

            // Analyze each coin for arbitrage opportunities
            for (const coin of eligibleCoins) {
                const exchangePrices = allPrices[coin.symbol];
                
                if (!exchangePrices) {
                    console.log(`‚ö†Ô∏è ${coin.symbol}: No data received`);
                    continue;
                }

                coin.exchangePrices = exchangePrices;

                // Filter out null prices
                const validPrices = Object.entries(exchangePrices)
                    .filter(([exchange, price]) => price !== null && exchange !== 'timestamp')
                    .map(([exchange, price]) => ({ exchange, price }));

                if (validPrices.length < 2) {
                    console.log(`‚ö†Ô∏è ${coin.symbol}: Not enough exchanges (${validPrices.length})`);
                    continue;
                }

                // Find lowest and highest prices
                validPrices.sort((a, b) => a.price - b.price);
                const buyExchange = validPrices[0];
                const sellExchange = validPrices[validPrices.length - 1];

                // Calculate real spread
                const buyPrice = buyExchange.price;
                const sellPrice = sellExchange.price;
                const grossSpreadPercent = ((sellPrice - buyPrice) / buyPrice) * 100;

                // Calculate fees
                const buyFee = EXCHANGE_FEES[buyExchange.exchange];
                const sellFee = EXCHANGE_FEES[sellExchange.exchange];
                const totalFees = buyFee + sellFee;

                // Net spread after fees
                const netSpread = grossSpreadPercent - totalFees;

                console.log(`üìä ${coin.symbol}: Buy ${buyExchange.exchange} $${buyPrice.toFixed(4)} ‚Üí Sell ${sellExchange.exchange} $${sellPrice.toFixed(4)} = ${netSpread.toFixed(2)}%`);

                if (netSpread >= minSpread) {
                    console.log(`‚úÖ OPPORTUNITY: ${coin.symbol} +${netSpread.toFixed(2)}%`);
                    opportunities.push({
                        coin: coin,
                        buyExchange: EXCHANGE_NAMES[buyExchange.exchange],
                        sellExchange: EXCHANGE_NAMES[sellExchange.exchange],
                        buyPrice: buyPrice,
                        sellPrice: sellPrice,
                        grossSpread: grossSpreadPercent.toFixed(2),
                        netSpread: netSpread.toFixed(2),
                        totalFees: totalFees.toFixed(2),
                        confidence: validPrices.length >= 3 ? 95 : 85,
                        lastUpdated: Date.now()
                    });
                }
            }

            return opportunities.sort((a, b) => parseFloat(b.netSpread) - parseFloat(a.netSpread));
        }

        async function scanMarkets() {
            const btn = document.getElementById('scanBtn');
            const container = document.getElementById('opportunitiesContainer');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; margin-right: 8px; border-width: 2px;"></div>Scanning...';
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <h3>Fetching Real Market Data</h3>
                    <p>Getting live prices from 8 exchanges (Binance, KuCoin, Gate.io, MEXC, Bybit, OKX, Huobi, Bitget)...</p>
                    <p style="margin-top: 10px; color: #4caf50;">‚ö° No CORS issues - using serverless backend!</p>
                </div>
            `;

            try {
                updateApiStatus('loading', 'Fetching coin list...');
                const success = await fetchCoinList();
                if (!success) {
                    throw new Error('Failed to fetch coin list from CoinGecko');
                }

                updateApiStatus('loading', 'Scanning exchanges for arbitrage...');
                opportunities = await findRealArbitrageOpportunities();
                
                console.log('üí∞ Total opportunities found:', opportunities.length);

                displayOpportunities();
                updateStats();
                updateApiStatus('online', `Live ‚Ä¢ ${opportunities.length} opportunities found`);
                lastUpdateTime = new Date();

            } catch (error) {
                console.error('‚ùå Scan failed:', error);
                displayError('Failed to scan markets. Please try again.');
                updateApiStatus('error', 'Scan failed');
            }

            btn.disabled = false;
            btn.innerHTML = '<span>‚ö°</span> Scan Live Markets';
        }

        function displayOpportunities() {
            const container = document.getElementById('opportunitiesContainer');
            
            if (opportunities.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <h3>üîç No Profitable Opportunities Found</h3>
                        <p>Current market conditions show minimal price differences across exchanges.</p>
                        <p style="margin-top: 15px;">Try lowering the minimum spread percentage or scanning at a different time when market volatility is higher.</p>
                        <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                            üìä Scanned <strong>${Object.keys(livePrices).length}</strong> coins across 4 exchanges
                        </div>
                        <div class="warning-badge">
                            ‚ö†Ô∏è Real exchange data - opportunities are rare in efficient markets
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = opportunities.map(opp => {
                const profitClass = parseFloat(opp.netSpread) > 2 ? 'high' : '';
                const changeClass = opp.coin.percent_change_24h >= 0 ? 'positive' : 'negative';
                const changeSign = opp.coin.percent_change_24h >= 0 ? '+' : '';
                
                return `
                    <div class="opportunity">
                        <div class="opp-header">
                            <div class="coin-info">
                                <h3>${opp.coin.name} (${opp.coin.symbol})</h3>
                                <div class="coin-details">
                                    Rank: <strong>#${opp.coin.rank}</strong><br>
                                    24h Change: <span class="price-change ${changeClass}">${changeSign}${opp.coin.percent_change_24h.toFixed(2)}%</span><br>
                                    Market Cap: $${formatNumber(opp.coin.market_cap)} ‚Ä¢ Volume: $${formatNumber(opp.coin.volume_24h)}
                                </div>
                            </div>
                            <div class="profit-display">
                                <div class="profit-percentage ${profitClass}">+${opp.netSpread}%</div>
                                <div class="profit-label" style="color: #a0a0a0; font-size: 0.8rem;">Net Profit</div>
                            </div>
                        </div>

                        <div class="exchanges">
                            <div class="exchange">
                                <div class="exchange-name">${opp.buyExchange}</div>
                                <div class="exchange-price">$${formatPrice(opp.buyPrice)}</div>
                                <span class="exchange-label buy-label">BUY</span>
                            </div>
                            <div class="arrow">‚Üí</div>
                            <div class="exchange">
                                <div class="exchange-name">${opp.sellExchange}</div>
                                <div class="exchange-price">$${formatPrice(opp.sellPrice)}</div>
                                <span class="exchange-label sell-label">SELL</span>
                            </div>
                        </div>

                        <div class="profit-breakdown">
                            <div class="profit-item">
                                <div class="profit-item-label">Profit on $1K</div>
                                <div class="profit-item-value">$${(1000 * parseFloat(opp.netSpread) / 100).toFixed(2)}</div>
                            </div>
                            <div class="profit-item">
                                <div class="profit-item-label">Profit on $5K</div>
                                <div class="profit-item-value">$${(5000 * parseFloat(opp.netSpread) / 100).toFixed(2)}</div>
                            </div>
                            <div class="profit-item">
                                <div class="profit-item-label">Gross Spread</div>
                                <div class="profit-item-value">${opp.grossSpread}%</div>
                            </div>
                            <div class="profit-item">
                                <div class="profit-item-label">Total Fees</div>
                                <div class="profit-item-value" style="color: #ff9800;">${opp.totalFees}%</div>
                            </div>
                            <div class="profit-item">
                                <div class="profit-item-label">Confidence</div>
                                <div class="profit-item-value">${opp.confidence}%</div>
                            </div>
                        </div>

                        <div class="last-updated">
                            üî¥ LIVE ‚Ä¢ Real Exchange Data ‚Ä¢ ${new Date(opp.lastUpdated).toLocaleTimeString()}
                        </div>
                        
                        <div class="warning-badge">
                            ‚ö†Ô∏è Verify prices on exchanges before trading. Prices change rapidly.
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayError(message) {
            const container = document.getElementById('opportunitiesContainer');
            container.innerHTML = `
                <div class="no-results">
                    <h3>‚ö†Ô∏è Error</h3>
                    <p>${message}</p>
                    <div style="margin-top: 15px;">
                        <button class="scan-btn" onclick="scanMarkets()">
                            <span>üîÑ</span> Try Again
                        </button>
                    </div>
                </div>
            `;
        }

        function updateStats() {
            document.getElementById('opportunitiesCount').textContent = opportunities.length;
            document.getElementById('coinsTracked').textContent = Object.keys(livePrices).length;
            document.getElementById('apiCalls').textContent = apiCallCount;
            document.getElementById('bestSpread').textContent = 
                opportunities.length > 0 ? opportunities[0].netSpread + '%' : '0%';
            document.getElementById('lastUpdate').textContent = 
                lastUpdateTime ? lastUpdateTime.toLocaleTimeString() : '--:--';
        }

        function formatPrice(price) {
            if (price >= 1000) return price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            if (price >= 100) return price.toFixed(2);
            if (price >= 1) return price.toFixed(3);
            if (price >= 0.01) return price.toFixed(4);
            if (price >= 0.0001) return price.toFixed(6);
            return price.toFixed(8);
        }

        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num ? num.toFixed(0) : '0';
        }

        // Auto-initialization removed - user must click "Scan Live Markets" button
        
        console.log('üì± Crypto Arbitrage Scanner loaded - using Backend API (Netlify Functions)');
        console.log('‚ö° Click "Scan Live Markets" to start scanning');
        console.log('üöÄ No CORS issues - all exchange requests go through serverless backend');
    </script>

    <!-- Footer -->
    <footer style="text-align: center; padding: 40px 20px; margin-top: 50px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <p style="color: #a0a0a0; font-size: 0.9rem; margin-bottom: 15px;">
            &copy; 2025 KarziTech. All rights reserved.
        </p>
        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
            <a href="/privacy/" style="color: #00d2ff; text-decoration: none; font-size: 0.9rem;">Privacy Policy</a>
            <span style="color: #666;">|</span>
            <a href="/privacy/" style="color: #00d2ff; text-decoration: none; font-size: 0.9rem;">Terms of Service</a>
        </div>
        <p style="color: #666; font-size: 0.8rem; margin-top: 15px;">
            ‚ö†Ô∏è Real exchange data. Always verify prices before trading.
        </p>
    </footer>
</body>
</html>
